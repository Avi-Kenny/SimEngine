<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='This function allows for simulations to be updated in parallel
    on a cluster computing system (CCS). See the Parallelization
    vignette for a detailed overview of how CCS parallelization works in
    SimEngine. Like run_on_cluster, the
    update_sim_on_cluster function acts as a wrapper for the code in
    your simulation, organizing the code into three sections, labeled "first"
    (code that is run once at the start of the simulation), "main" (running
    the simulation script repeatedly), and "last" (code to process or
    summarize simulation results). This function is to be used in conjunction
    with job scheduler software (e.g., Slurm or Oracle Grid Engine) to divide
    the simulation into tasks that are run in parallel on the CCS.'><title>Framework for updating simulations on a cluster computing system — update_sim_on_cluster • SimEngine</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Framework for updating simulations on a cluster computing system — update_sim_on_cluster"><meta property="og:description" content='This function allows for simulations to be updated in parallel
    on a cluster computing system (CCS). See the Parallelization
    vignette for a detailed overview of how CCS parallelization works in
    SimEngine. Like run_on_cluster, the
    update_sim_on_cluster function acts as a wrapper for the code in
    your simulation, organizing the code into three sections, labeled "first"
    (code that is run once at the start of the simulation), "main" (running
    the simulation script repeatedly), and "last" (code to process or
    summarize simulation results). This function is to be used in conjunction
    with job scheduler software (e.g., Slurm or Oracle Grid Engine) to divide
    the simulation into tasks that are run in parallel on the CCS.'><meta property="og:image" content="https://avi-kenny.github.io/SimEngine/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SimEngine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/SimEngine.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced-functionality.html">Advanced functionality</a>
    <a class="dropdown-item" href="../articles/example_1.html">Example 1: Simulation-based power calculation</a>
    <a class="dropdown-item" href="../articles/example_2.html">Example 2: Comparing two standard error estimators</a>
    <a class="dropdown-item" href="../articles/parallelization.html">Parallelization</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Avi-Kenny/SimEngine/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Framework for updating simulations on a cluster computing system</h1>
      <small class="dont-index">Source: <a href="https://github.com/Avi-Kenny/SimEngine/blob/HEAD/R/update_sim_on_cluster.R" class="external-link"><code>R/update_sim_on_cluster.R</code></a></small>
      <div class="d-none name"><code>update_sim_on_cluster.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function allows for simulations to be updated in parallel
    on a cluster computing system (CCS). See the <a href="https://avi-kenny.github.io/SimEngine/articles/parallelization.html">Parallelization</a>
    vignette for a detailed overview of how CCS parallelization works in
    <span class="pkg">SimEngine</span>. Like <code><a href="run_on_cluster.html">run_on_cluster</a></code>, the
    <code>update_sim_on_cluster</code> function acts as a wrapper for the code in
    your simulation, organizing the code into three sections, labeled "first"
    (code that is run once at the start of the simulation), "main" (running
    the simulation script repeatedly), and "last" (code to process or
    summarize simulation results). This function is to be used in conjunction
    with job scheduler software (e.g., Slurm or Oracle Grid Engine) to divide
    the simulation into tasks that are run in parallel on the CCS.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">update_sim_on_cluster</span><span class="op">(</span><span class="va">first</span>, <span class="va">main</span>, <span class="va">last</span>, <span class="va">cluster_config</span>, keep_errors <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>first</dt>
<dd><p>Code to run at the start of a simulation. This should be a block
of code enclosed by curly braces  that reads in a previously-run
simulation object via <code>readRDS</code> and makes changes to it via
<code><a href="set_levels.html">set_levels</a></code> or <code><a href="set_config.html">set_config</a></code>.</p></dd>


<dt>main</dt>
<dd><p>Code that will run for every simulation replicate. This should be
a block of code enclosed by curly braces , and will typically be a
single line of code calling the <code><a href="update_sim.html">update_sim</a></code>) function. This
code block will have access to the simulation object you created in the
'first' code block, but any changes made here to the simulation object
will not be saved.</p></dd>


<dt>last</dt>
<dd><p>Code that will run after all simulation replicates have been run.
This should be a block of code enclosed by curly braces  that processes
your simulation object (which at this point will contain your updated
results), which may involve calls to <code><a href="summarize.html">summarize</a></code>, creation of
plots, and so on.</p></dd>


<dt>cluster_config</dt>
<dd><p>A list of configuration options. You must specify
either <code>js</code> (the job scheduler you are using) or <code>tid_var</code> (the
name of the environment variable that your task ID is stored in); see
examples. Run <code><a href="js_support.html">js_support()</a></code> to see a list of job schedulers that
are currently supported. You can optionally also specify <code>dir</code>,
which is a character string representing a path to a directory on the
CCS; this directory will serve as your working directory and hold your
simulation object and all temporary objects created by <span class="pkg">SimEngine</span>.
If unspecified, this defaults to the working directory of the R script
that contains your simulation code).</p></dd>


<dt>keep_errors</dt>
<dd><p>logical (<code>TRUE</code> by default); if <code>TRUE</code>, do not
try to re-run simulation reps that results in errors previously; if
<code>FALSE</code>, attempt to run those reps again</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co"># The following code is saved in a file called my_simulation.R:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://avi-kenny.github.io/SimEngine/">SimEngine</a></span><span class="op">)</span></span>
<span><span class="fu">update_sim_on_cluster</span><span class="op">(</span></span>
<span>  first <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"sim.rds"</span><span class="op">)</span></span>
<span>    <span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="set_levels.html">set_levels</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">500</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  main <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="update_sim.html">update_sim</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  last <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="summarize.html">summarize</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  cluster_config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>js<span class="op">=</span><span class="st">"slurm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The following code is saved in a file called run_sim.sh:</span></span>
<span><span class="co"># #!/bin/bash</span></span>
<span><span class="co"># Rscript my_simulation.R</span></span>
<span></span>
<span><span class="co"># The following lines of code are run on the CCS head node:</span></span>
<span><span class="co"># sbatch --export=sim_run='first' run_sim.sh</span></span>
<span><span class="co"># sbatch --export=sim_run='main' --array=1-20 --depend=afterok:101 run_sim.sh</span></span>
<span><span class="co"># sbatch --export=sim_run='last' --depend=afterok:102 run_sim.sh</span></span>
<span><span class="op">}</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Avi Kenny, Charles Wolock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

