<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SimEngine">
<title>Introduction to SimEngine • SimEngine</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to SimEngine">
<meta property="og:description" content="SimEngine">
<meta property="og:image" content="https://avi-kenny.github.io/SimEngine/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SimEngine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/SimEngine.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced-usage.html">Advanced usage</a>
    <a class="dropdown-item" href="../articles/example_1.html">Example 1: Simulation-based power calculation</a>
    <a class="dropdown-item" href="../articles/example_2.html">Example 2: Comparing two standard error estimators</a>
    <a class="dropdown-item" href="../articles/parallelization.html">Parallelization</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Avi-Kenny/SimEngine/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to SimEngine</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Avi-Kenny/SimEngine/blob/HEAD/vignettes/SimEngine.Rmd" class="external-link"><code>vignettes/SimEngine.Rmd</code></a></small>
      <div class="d-none name"><code>SimEngine.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>SimEngine</strong> is an open-source R package for
structuring, maintaining, running, and debugging statistical simulations
on both local and cluster-based computing environments.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>The goal of many statistical simulations is to test how a new
statistical method performs against existing methods. Most statistical
simulations include three basic phases: (1) generate some data, (2) run
one or more methods using the generated data, and (3) compare the
performance of the methods.</p>
<p>To briefly illustrate how these phases are implemented using
<strong>SimEngine</strong>, we will use the example of estimating the
average treatment effect of a drug in the context of a randomized
controlled trial (RCT).</p>
<div class="section level3">
<h3 id="load-the-package-and-create-a-simulation-object">1) Load the package and create a “simulation object”<a class="anchor" aria-label="anchor" href="#load-the-package-and-create-a-simulation-object"></a>
</h3>
<p>The simulation object (an R object of class <em>sim_obj</em>) will
contain all data, functions, and results related to your simulation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://avi-kenny.github.io/SimEngine/">SimEngine</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: magrittr</span></span>
<span><span class="co">#&gt; Welcome to SimEngine! Full package documentation can be found at:</span></span>
<span><span class="co">#&gt;  https://avi-kenny.github.io/SimEngine</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_sim.html">new_sim</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-a-function-to-generate-some-data">2) Code a function to generate some data<a class="anchor" aria-label="anchor" href="#code-a-function-to-generate-some-data"></a>
</h3>
<p>Most simulations will involve one or more functions that create a
dataset designed to mimic some real-world data structure. Here, we write
a function that simulates data from an RCT in which we compare a
continuous outcome (e.g. blood pressure) between a treatment group and a
control group. We generate the data by looping through a set of
patients, assigning them randomly to one of the two groups, and
generating their outcome according to a simple model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Code up the dataset-generating function</span></span>
<span><span class="va">create_rct_data</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">num_patients</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">"patient_id"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="st">"group"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="st">"outcome"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_patients</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span>, <span class="st">"treatment"</span>, <span class="st">"control"</span><span class="op">)</span></span>
<span>    <span class="va">treatment_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">group</span><span class="op">==</span><span class="st">"treatment"</span>, <span class="op">-</span><span class="fl">7</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, mean<span class="op">=</span><span class="fl">130</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">treatment_effect</span></span>
<span>    <span class="va">df</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">group</span>, <span class="va">outcome</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">create_rct_data</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;   patient_id     group  outcome</span></span>
<span><span class="co">#&gt; 1          1   control 132.0245</span></span>
<span><span class="co">#&gt; 2          2   control 129.7410</span></span>
<span><span class="co">#&gt; 3          3 treatment 123.1057</span></span>
<span><span class="co">#&gt; 4          4 treatment 124.3525</span></span>
<span><span class="co">#&gt; 5          5   control 128.9242</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="code-your-methods-or-other-functions">3) Code your methods (or other functions)<a class="anchor" aria-label="anchor" href="#code-your-methods-or-other-functions"></a>
</h3>
<p>With <strong>SimEngine</strong>, any functions that you declare (or
load via <code>source</code>) are automatically added to your simulation
object when the simulation runs. In this example, we test two different
estimators of the average treatment effect. For simplicity, we code this
as a single function and use the <code>type</code> argument to specify
which estimator we want to use, but you could also write two separate
functions. The first estimator uses the known probability of being
assigned to the treatment group (0.5), whereas the second estimator uses
an estimate of this probability based on the observed data. Don’t worry
too much about the mathematical details; the important thing is that
both methods attempt to take in the dataset generated by the
<code>create_rct_data</code> function and return an estimate of the
treatment effect, which in this case is <em>-7</em>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Code up the estimators</span></span>
<span><span class="va">est_tx_effect</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">type</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  <span class="va">sum_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">outcome</span> <span class="op">*</span> <span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"treatment"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sum_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">outcome</span> <span class="op">*</span> <span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"control"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">type</span><span class="op">==</span><span class="st">"est1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">true_prob</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span> <span class="va">sum_t</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">true_prob</span><span class="op">)</span> <span class="op">-</span> <span class="va">sum_c</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">true_prob</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">type</span><span class="op">==</span><span class="st">"est2"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">est_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"treatment"</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span> <span class="va">sum_t</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">est_prob</span><span class="op">)</span> <span class="op">-</span> <span class="va">sum_c</span><span class="op">/</span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">est_prob</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test out the estimators</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">create_rct_data</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu">est_tx_effect</span><span class="op">(</span><span class="va">df</span>, <span class="st">"est1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -11.49575</span></span>
<span><span class="fu">est_tx_effect</span><span class="op">(</span><span class="va">df</span>, <span class="st">"est2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -6.947072</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="set-the-simulation-levels">4) Set the simulation levels<a class="anchor" aria-label="anchor" href="#set-the-simulation-levels"></a>
</h3>
<p>Often, we want to run the same simulation multiple times (with each
run referred to as a “simulation replicate”), but with certain things
changed. In this example, perhaps we want to vary the number of patients
and the method used to estimate the average treatment effect. We refer
to the things that vary as “simulation levels”. By default,
<strong>SimEngine</strong> will run our simulation 10 times for each
level combination. Below, since there are two methods and three values
of num_patients, we have six level combinations and so
<strong>SimEngine</strong> will run a total of 60 simulation replicates.
Note that we make extensive use of the pipe operators
(<code>%&gt;%</code> and <code>%&lt;&gt;%</code>) from the
<strong>magrittr</strong> package; if you have never used pipes, check
out the <a href="https://magrittr.tidyverse.org" class="external-link">magrittr
documentation</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="../reference/set_levels.html">set_levels</a></span><span class="op">(</span></span>
<span>  estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"est1"</span>, <span class="st">"est2"</span><span class="op">)</span>,</span>
<span>  num_patients <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">200</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-simulation-script">5) Create a simulation script<a class="anchor" aria-label="anchor" href="#create-a-simulation-script"></a>
</h3>
<p>The simulation script is a function that runs a single simulation
replicate and returns the results. Within a script, you can reference
the current simulation level values using the variable <em>L</em>. For
example, when the first simulation replicate is running,
<code>L$estimator</code> will equal “est1” and
<code>L$num_patients</code> will equal 50. In the last simulation
replicate, <code>L$estimator</code> will equal “est2” and
<code>L$num_patients</code> will equal 1,000. Your script will
automatically have access to any functions that you created earlier.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="../reference/set_script.html">set_script</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">create_rct_data</span><span class="op">(</span><span class="va">L</span><span class="op">$</span><span class="va">num_patients</span><span class="op">)</span></span>
<span>  <span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">est_tx_effect</span><span class="op">(</span><span class="va">df</span>, <span class="va">L</span><span class="op">$</span><span class="va">estimator</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"est"</span> <span class="op">=</span> <span class="va">est</span>,</span>
<span>    <span class="st">"mean_t"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">outcome</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"treatment"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="st">"mean_c"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">outcome</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">==</span><span class="st">"control"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Your script should always return a list containing key-value pairs,
where the keys are character strings and the values are simple data
types (numbers, character strings, or boolean values). If you need to
return more complex data types (e.g. lists or dataframes), see the
<a href="https://avi-kenny.github.io/SimEngine/advanced-usage/">Advanced
usage</a> documentation page. Note that in this example, you could have
alternatively coded your estimators as separate functions and called
them from within the script using the
<a href="https://avi-kenny.github.io/SimEngine/function-reference/use_method/"><code>use_method</code></a>
function.</p>
</div>
<div class="section level3">
<h3 id="set-the-simulation-configuration">6) Set the simulation configuration<a class="anchor" aria-label="anchor" href="#set-the-simulation-configuration"></a>
</h3>
<p>This controls options related to your entire simulation, such as the
number of simulation replicates to run for each level combination and
how to
<a href="https://avi-kenny.github.io/SimEngine/parallelization/">parallelize</a>
your code. This is also where you should specify any packages your
simulation needs (instead of using <code>library</code> or
<code>require</code>). See the
<a href="https://avi-kenny.github.io/SimEngine/function-reference/set_config/"><code>set_config</code></a>
docs for more info. We set <code>num_sim</code> to 100, and so
<strong>SimEngine</strong> will run a total of 600 simulation replicates
(100 for each of the six level combinations).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="../reference/set_config.html">set_config</a></span><span class="op">(</span></span>
<span>  num_sim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"stringr"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ggplot2'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:SimEngine':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     vars</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-the-simulation">7) Run the simulation<a class="anchor" aria-label="anchor" href="#run-the-simulation"></a>
</h3>
<p>All 600 replicates are run at once and results are stored in the
simulation object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Done. No errors or warnings detected.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="view-and-summarize-results">8) View and summarize results<a class="anchor" aria-label="anchor" href="#view-and-summarize-results"></a>
</h3>
<p>Once the simulations have finished, use the <code>summarize</code>
function to calculate common summary statistics, such as bias, variance,
MSE, and coverage.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/summarize.html">summarize</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"bias"</span>, truth<span class="op">=</span><span class="op">-</span><span class="fl">7</span>, estimate<span class="op">=</span><span class="st">"est"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"mse"</span>, truth<span class="op">=</span><span class="op">-</span><span class="fl">7</span>, estimate<span class="op">=</span><span class="st">"est"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   level_id estimator num_patients n_reps    bias_est      MSE_est</span></span>
<span><span class="co">#&gt; 1        1      est1           50    100 -3.99764574 1.348635e+03</span></span>
<span><span class="co">#&gt; 2        2      est2           50    100  0.05183922 3.341945e-01</span></span>
<span><span class="co">#&gt; 3        3      est1          200    100  0.54368508 2.717583e+02</span></span>
<span><span class="co">#&gt; 4        4      est2          200    100 -0.01142372 9.064865e-02</span></span>
<span><span class="co">#&gt; 5        5      est1         1000    100  0.40180140 5.373561e+01</span></span>
<span><span class="co">#&gt; 6        6      est2         1000    100 -0.01681643 1.944518e-02</span></span></code></pre></div>
<p>In this example, we see that the MSE of estimator 1 is much higher
than that of estimator 2 and that MSE decreases with increasing sample
size for both estimators, as expected. You can also directly access the
results for individual simulation replicates.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sim_uid level_id rep_id estimator num_patients     runtime        est</span></span>
<span><span class="co">#&gt; 1       1        1      1      est1           50 0.005337715  13.490228</span></span>
<span><span class="co">#&gt; 2       7        1      2      est1           50 0.003467321 -36.213704</span></span>
<span><span class="co">#&gt; 3       8        1      3      est1           50 0.005448341 -36.302800</span></span>
<span><span class="co">#&gt; 4       9        1      4      est1           50 0.003302574  -6.510656</span></span>
<span><span class="co">#&gt; 5      10        1      5      est1           50 0.003606796   2.095171</span></span>
<span><span class="co">#&gt; 6      11        1      6      est1           50 0.006608009  34.020766</span></span>
<span><span class="co">#&gt;     mean_t   mean_c</span></span>
<span><span class="co">#&gt; 1 122.8420 129.5426</span></span>
<span><span class="co">#&gt; 2 123.0957 129.0517</span></span>
<span><span class="co">#&gt; 3 123.1292 129.1576</span></span>
<span><span class="co">#&gt; 4 123.2329 129.7435</span></span>
<span><span class="co">#&gt; 5 122.5421 130.5715</span></span>
<span><span class="co">#&gt; 6 123.5936 130.1760</span></span></code></pre></div>
<p>Above, the <code>sim_uid</code> uniquely identifies a single
simulation replicate and the <code>level_id</code> uniquely identifies a
level combination. The rep_id is unique within a given level combination
and identifies the replicate.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Avi Kenny, Charles Wolock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
